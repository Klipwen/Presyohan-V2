To implement the real profile icon logic "just like the web version," we need to fetch the avatar_url from your Supabase database and load it into the Android app using an image loading library.

I recommend using Coil (Coroutine Image Loader), which is the industry standard for modern Android/Kotlin apps. It's lightweight, fast, and handles circular cropping automatically.

Here are the 4 steps to implement this:

1. Add the Coil Dependency
Open your app/build.gradle.kts file and add the Coil library to your dependencies block.

Kotlin

dependencies {
    // ... existing dependencies ...

    // Add Coil for loading images from URLs
    implementation("io.coil-kt:coil:2.6.0")
}
Sync your project after adding this.

2. Update SupabaseAuthService.kt
Update your auth service to retrieve the avatar_url field. We need to check both the database table (app_users) and the auth metadata (as a fallback).

Step A: Update the AppUserRow data class at the bottom of the file:

Kotlin

@kotlinx.serialization.Serializable
data class AppUserRow(
    val id: String,
    val name: String? = null,
    val email: String? = null,
    val user_code: String? = null,
    val avatar_url: String? = null // Add this field
)
Step B: Update the getUserProfile() function to fetch this field:

Kotlin

    // Inside SupabaseAuthService object
    suspend fun getUserProfile(): AppUserRow? = withContext(Dispatchers.IO) {
        val uid = client.auth.currentUserOrNull()?.id ?: return@withContext null
        return@withContext try {
            // 1. Try to get from database
            val rows = client.postgrest["app_users"].select {
                filter { eq("id", uid) }
                limit(1)
            }.decodeList<AppUserRow>()
            var row = rows.firstOrNull()

            // 2. Get Metadata as fallback (for Google Sign-In avatars etc)
            val metaAny: Any? = client.auth.currentUserOrNull()?.userMetadata
            val metaName = when (metaAny) {
                is Map<*, *> -> metaAny["name"] as? String
                is JsonObject -> metaAny["name"]?.jsonPrimitive?.contentOrNull
                else -> null
            }
            val metaAvatar = when (metaAny) {
                is Map<*, *> -> metaAny["avatar_url"] as? String
                is JsonObject -> metaAny["avatar_url"]?.jsonPrimitive?.contentOrNull
                else -> null
            }

            // 3. Merge Data
            if (row == null) {
                row = AppUserRow(id = uid, name = metaName, avatar_url = metaAvatar)
            } else {
                // If DB fields are empty, fill them with metadata
                if (row.name.isNullOrBlank()) row = row.copy(name = metaName)
                if (row.avatar_url.isNullOrBlank()) row = row.copy(avatar_url = metaAvatar)
            }
            row
        } catch (e: Exception) { null }
    }
3. Update drawer_header.xml
We will use a standard ImageView but ensure it has no hardcoded tint that would color over your real image.

Open app/src/main/res/layout/drawer_header.xml:

XML

<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    android:gravity="center_vertical"
    android:background="#FFB703"
    android:padding="16dp">

    <ImageView
        android:id="@+id/drawerUserIcon"
        android:layout_width="64dp"
        android:layout_height="64dp"
        android:src="@drawable/icon_profile"
        android:contentDescription="User Icon"
        android:layout_gravity="center_horizontal" />

    <TextView
        android:id="@+id/drawerUserName"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="User Name"
        android:textColor="@android:color/white"
        android:textSize="18sp"
        android:textStyle="bold"
        android:layout_marginTop="12dp"
        android:layout_gravity="center_horizontal" />

    <TextView
        android:id="@+id/drawerUserCode"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="ID: --"
        android:textColor="@android:color/white"
        android:textSize="14sp"
        android:alpha="0.9"
        android:layout_marginTop="2dp"
        android:layout_gravity="center_horizontal" />

</LinearLayout>
4. Update HomeActivity.kt
Finally, update the updateDrawerHeader function to load the image using Coil and apply a circular crop.

Add these imports to the top of HomeActivity.kt:

Kotlin

import io.coil.load
import io.coil.transform.CircleCropTransformation
Then replace your updateDrawerHeader function with this:

Kotlin

    private fun updateDrawerHeader(navView: NavigationView) {
        val h = navView.getHeaderView(0)
        val uT = h.findViewById<TextView>(R.id.drawerUserName)
        val codeT = h.findViewById<TextView>(R.id.drawerUserCode)
        val img = h.findViewById<ImageView>(R.id.drawerUserIcon)

        // 1. Set Default State (Placeholder)
        uT.text = "User"
        codeT?.visibility = View.GONE
        // Reset image to default icon just in case
        img.setImageResource(R.drawable.icon_profile) 
        
        // Optional: Apply a white tint ONLY to the placeholder if it's a flat icon
        img.setColorFilter(ContextCompat.getColor(this, R.color.white))

        lifecycleScope.launch {
            // Fetch full profile
            val profile = SupabaseAuthService.getUserProfile()
            
            if (profile != null) {
                // 2. Set Name
                if (!profile.name.isNullOrBlank()) {
                    uT.text = profile.name
                }

                // 3. Set User Code (ID: PH25-xxxx)
                if (!profile.user_code.isNullOrBlank()) {
                    val formattedId = profile.user_code.uppercase()
                    codeT?.text = "ID: $formattedId"
                    codeT?.visibility = View.VISIBLE
                }

                // 4. Load Real Profile Image
                if (!profile.avatar_url.isNullOrBlank()) {
                    // Remove the tint so the real photo shows in full color
                    img.clearColorFilter()
                    
                    // Load with Coil
                    img.load(profile.avatar_url) {
                        crossfade(true)
                        // This creates the professional circular look
                        transformations(CircleCropTransformation())
                        // Fallback if loading fails
                        error(R.drawable.icon_profile)
                    }
                }
            } 
        }
    }
This implementation automatically checks if the user has a real photo. If they do, it removes the flat icon tint, loads the photo from the URL, and crops it into a perfect circle.
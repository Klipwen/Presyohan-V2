# Presyohan: Import Prices Feature — Professional Project Plan

## 1. Project Purpose / Business Justification

The **Import Prices** feature allows store owners to upload a standardized Excel pricelist and automatically sync product information into Presyohan. This improves operational efficiency by eliminating manual data encoding, reducing human error, and accelerating store onboarding as well as bulk price updates.

This feature is strategically aligned with Presyohan’s goal of:

* Providing a fast and user-friendly inventory/pricelist management system.
* Ensuring that the exported pricelist (from “Convert to Excel”) can be re‑imported without issues.
* Supporting multi-branch stores where owners manage pricing across several locations.

With this feature, businesses benefit from:

* Faster store setup.
* Faster bulk price updates.
* Consistent and accurate product data.
* Lower operational overhead.

---

## 2. Objectives

1. **Enable store owners to upload a pricelist in Excel format (.xlsx) that uses the exact structure produced by the Convert to Excel feature.**
2. **Validate the uploaded file** to ensure it contains the required fields:

   * Item Name
   * Description
   * Category
   * Unit
   * Price
3. **Provide a guided, user-friendly, error-proof workflow** that follows a professional import process.
4. **Perform a dry‑run preview** showing items to be created and items to be updated.
5. **Apply all changes in a safe, transactional, and auditable manner**, ensuring no partial or corrupted data imports.
6. **Log import activity** for accountability and tracking.
7. **Ensure the entire flow matches the design language and UX style of Presyohan.**

---

## 3. Scope

### 3.1 In-Scope

* Adding an Import Prices button in Store Settings (Owner only).
* Designing a 3-step import modal:

  1. **Upload File**
  2. **Validate & Preview**
  3. **Review & Import**
* Backend processing of the uploaded Excel.
* Validation of structure and field completeness.
* Required field mapping (no optional fields; strict structure).
* Dry-run generation.
* Transactional upsert into the products/prices database.
* Audit logging.
* Error handling (file format, missing fields, invalid values, etc.).

### 3.2 Out-of-Scope

* Importing CSV files (only .xlsx).
* Mapping custom user-defined column names.
* Multi-file uploads.
* Editing items inside the import modal.

---

## 4. Deliverables

### 4.1 UI/UX Deliverables

**1. Import Button (Store Settings UI)**

**2. Import Modal (3-Step Process)**

#### Step 1 — Upload File

* Drag-and-drop zone + button
* Accepts **.xlsx only**
* Immediately scans the file for structure
* User-friendly errors if file does not match required layout

#### Step 2 — Validation & Preview

* Display a clean table showing:

  * Item name
  * Description(optional)
  * Category
  * Unit
  * Price
* Highlight missing required fields
* Show summary:

  * `Total items: X`
  * `Valid rows: Y`
  * `Rows with issues: Z` (if any)
* If errors are found → disable Next and show list of issues with row numbers
* If no errors → enable Next

#### Step 3 — Review & Import

* Display:

  * Items that will be **created**
  * Items that will be **updated**
* Provide totals: `Creates: A | Updates: B`
* Confirm & Import button

**Progress State:**

* Show processing loader + text: “Importing prices…”

**Success State:**

* Toast: “Import completed successfully!”
* Display summary results: created A items, updated B items

---

### 4.2 Backend Deliverables

**1. Excel Parser**

* Using server-side library 
* Reads workbook
* Validates columns by exact header names

**2. Validation Engine**

* Checks:

  * Required columns exist

  * No empty required fields

  * Price is numeric

  * Descriptions (optional)

  * Category & Unit text are valid format

**3. Dry-Run Processor**

* Compares incoming rows to destination store database
* Determines whether each row will:

  * Create a new product
  * Update an existing product

**4. Transactional Upsert Engine**

* Performs bulk operations grouped by category
* Uses `INSERT ... ON CONFLICT DO UPDATE` (Postgres)
* Ensures all or nothing changes

---

### 4.3 System / Architecture Deliverables

* Secure upload endpoint: `POST /api/stores/{id}/import-prices`
* File stored temporarily in memory or temp storage (not persistent)
* Validation → Dry-run → Commit flow
* Manage import size up to 10,000 rows

---

## 5. Professional Workflow (Step-by-Step)

### Step 1 — User Opens Import

1. Owner goes to **Store Settings → Manage Store**.
2. Clicks **Import Prices**.
3. Import modal appears (Step 1: Upload File).

---

### Step 2 — Upload & Validate File

1. User uploads file.
2. Backend immediately checks:

   * Is the file .xlsx format?
   * Are required columns present?
3. Backend parses rows and returns validation result:

   * Valid rows
   * Rows with errors
4. UI shows results clearly:

   * If row errors exist → user must fix the file and re-upload
   * If valid → user may proceed

---

### Step 3 — Preview (Dry Run)

1. Backend compares each product row to the store’s existing database:

   * Item exists? → mark as **update**
   * Item does not exist? → mark as **create**
2. Backend sends preview summary to UI.
3. UI shows:

   * Table of items to be created & updated
   * Totals
4. User writes an optional note.
5. User clicks **Confirm & Import**.

---

### Step 4 — Import Execution

1. Backend revalidates file structure.
2. Starts database transaction.
3. Performs bulk upserts.
4. Writes audit log.
5. Generates import report.
6. Returns success response.

---

### Step 5 — Completion

* UI shows: `Import successful — A items created, B items updated.`
* User can download import report.
* Notification added in system.

---

## 6. Notes on UX & Professional Best Practices

* Enforce strict matching with exported template → ensures smooth round‑trip
* Use clear error messages with row numbers and suggestions
* Use color codes for create/update (that align with the design)
* Ensure mobile-responsive modal
* Maximum friendliness: drag-and-drop file import, progress indicators, inline previews
* Zero-risk data handling: always dry-run first, then transactional import

---

## 7. Final Recommendations

* Only allow .xlsx files exported by Presyohan to reduce user errors.
* Keep the 3-step modal flow simple and consistent with Copy Prices UX.
* Provide ready-to-download sample template.

This feature will make Presyohan significantly more powerful, enabling fast, error-free bulk price management through a professional and user-friendly import workflow.

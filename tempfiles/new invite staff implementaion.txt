Here is the complete implementation to bring the website's "Invite Staff" logic (unified search, debouncing, user card display, and direct invitation) to your Android app.

1. Update dialog_invite_staff.xml
I have redesigned the input section to be a search bar and added the "User Found" card layout, which is hidden by default.

File: app/src/main/res/layout/dialog_invite_staff.xml

XML

<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:orientation="vertical"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:padding="24dp"
    android:background="@drawable/bg_rounded"
    android:minWidth="350dp"
    android:gravity="center_horizontal"
    android:elevation="8dp">

    <TextView
        android:id="@+id/inviteStaffTitle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Invite Staff"
        android:textSize="22sp"
        android:textStyle="bold"
        android:textColor="@color/presyo_orange"
        android:layout_marginBottom="4dp"/>

    <ImageView
        android:layout_width="64dp"
        android:layout_height="64dp"
        android:src="@drawable/icon_invite_staff"
        android:layout_marginBottom="16dp"/>

    <LinearLayout
        android:orientation="vertical"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:background="#F5F4F3"
        android:padding="16dp"
        android:layout_marginBottom="20dp"
        android:background="@drawable/bg_rounded">

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="Store Code"
            android:textSize="12sp"
            android:textStyle="bold"
            android:textColor="#666666"
            android:layout_marginBottom="8dp"/>

        <LinearLayout
            android:orientation="horizontal"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:gravity="center_vertical">

            <FrameLayout
                android:layout_width="48dp"
                android:layout_height="48dp"
                android:background="@drawable/bg_rounded"
                android:backgroundTint="@color/presyo_orange">
                <ImageView
                    android:layout_width="24dp"
                    android:layout_height="24dp"
                    android:src="@drawable/icon_store"
                    android:layout_gravity="center"
                    app:tint="@android:color/white"/>
            </FrameLayout>

            <View android:layout_width="12dp" android:layout_height="1dp"/>

            <LinearLayout
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:orientation="vertical">

                <TextView
                    android:id="@+id/inviteCodeExpiry"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Expires in 23:59:00"
                    android:textSize="10sp"
                    android:textColor="#888888"
                    android:layout_gravity="center_horizontal"
                    android:layout_marginBottom="2dp"/>

                <TextView
                    android:id="@+id/storeCodeText"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="..."
                    android:textSize="20sp"
                    android:textStyle="bold"
                    android:textColor="@color/presyo_teal"
                    android:gravity="center"
                    android:background="@drawable/bg_white"
                    android:paddingVertical="8dp"/>
            </LinearLayout>

            <View android:layout_width="12dp" android:layout_height="1dp"/>

            <FrameLayout
                android:id="@+id/btnCopyCode"
                android:layout_width="48dp"
                android:layout_height="48dp"
                android:background="@drawable/bg_rounded"
                android:backgroundTint="@color/presyo_teal"
                android:clickable="true"
                android:focusable="true">
                <ImageView
                    android:layout_width="24dp"
                    android:layout_height="24dp"
                    android:src="@drawable/icon_copy"
                    android:layout_gravity="center"
                    app:tint="@android:color/white"/>
            </FrameLayout>
        </LinearLayout>

        <TextView
            android:id="@+id/btnGenerateCode"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="Regenerate Code"
            android:textColor="@color/presyo_orange"
            android:textSize="12sp"
            android:textStyle="bold"
            android:layout_gravity="center_horizontal"
            android:padding="8dp"
            android:layout_marginTop="8dp"/>
    </LinearLayout>

    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="User ID or Email Address"
        android:textSize="12sp"
        android:textStyle="bold"
        android:textColor="#666666"
        android:layout_marginBottom="6dp"/>

    <FrameLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content">

        <EditText
            android:id="@+id/searchInput"
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:background="@drawable/bg_edittext"
            android:hint="Enter valid user ID or email"
            android:textColor="@color/black"
            android:textSize="14sp"
            android:paddingStart="16dp"
            android:paddingEnd="40dp"
            android:maxLines="1"
            android:inputType="textEmailAddress"/>

        <ProgressBar
            android:id="@+id/searchLoader"
            android:layout_width="24dp"
            android:layout_height="24dp"
            android:layout_gravity="center_vertical|end"
            android:layout_marginEnd="12dp"
            android:visibility="gone"
            android:indeterminateTint="@color/presyo_orange"/>

        <ImageView
            android:id="@+id/searchIconStatic"
            android:layout_width="24dp"
            android:layout_height="24dp"
            android:src="@drawable/icon_search"
            android:layout_gravity="center_vertical|end"
            android:layout_marginEnd="12dp"
            app:tint="#999999"/>
    </FrameLayout>

    <TextView
        android:id="@+id/textNotFound"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="No user found with this ID or Email."
        android:textColor="#D32F2F"
        android:textSize="12sp"
        android:layout_marginTop="4dp"
        android:visibility="gone"/>

    <LinearLayout
        android:id="@+id/userResultContainer"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:background="#FFFBE6"
        android:padding="12dp"
        android:layout_marginTop="8dp"
        android:gravity="center_vertical"
        android:visibility="gone">
        <com.google.android.material.image.ShapeableImageView
            android:id="@+id/foundUserAvatar"
            android:layout_width="40dp"
            android:layout_height="40dp"
            android:src="@drawable/icon_profile"
            app:shapeAppearanceOverlay="@style/CircularImage"
            android:scaleType="centerCrop"
            android:background="#E0E0E0"/>

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:layout_marginStart="12dp">
            
            <TextView
                android:id="@+id/foundUserName"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="User Name"
                android:textStyle="bold"
                android:textColor="#333333"
                android:textSize="14sp"/>

            <TextView
                android:id="@+id/foundUserDetails"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="PH25-0001 • email@example.com"
                android:textColor="#666666"
                android:textSize="12sp"
                android:ellipsize="end"
                android:maxLines="1"/>
        </LinearLayout>
    </LinearLayout>

    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="Staff Role"
        android:textSize="12sp"
        android:textStyle="bold"
        android:textColor="#666666"
        android:layout_marginTop="16dp"
        android:layout_marginBottom="6dp"/>

    <Spinner
        android:id="@+id/roleSpinner"
        android:layout_width="match_parent"
        android:layout_height="50dp"
        android:background="@drawable/bg_edittext"
        android:paddingStart="4dp"
        android:layout_marginBottom="24dp"/>

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:weightSum="2">

        <android.widget.Button
            android:id="@+id/btnBack"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="Back"
            android:background="@drawable/button_round_teal"
            android:textColor="@color/white"
            android:layout_marginEnd="8dp"/>

        <android.widget.Button
            android:id="@+id/btnInvite"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="Invite"
            android:background="@drawable/button_round_orange"
            android:textColor="@color/white"
            android:enabled="false"
            android:alpha="0.5"/>
    </LinearLayout>

    <TextView
        android:id="@+id/inviteErrorText"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:textColor="#D32F2F"
        android:textSize="12sp"
        android:layout_marginTop="8dp"
        android:visibility="gone"/>

</LinearLayout>
2. Update HomeActivity.kt
I will add the data class for the search result, the debounced search logic using Handler and TextWatcher, and the updated invitation logic.

Add these imports:

Kotlin

import android.text.Editable
import android.text.TextWatcher
import io.coil.load
import io.coil.transform.CircleCropTransformation
Add this data class inside HomeActivity (or at file level):

Kotlin

    @Serializable
    data class SearchedUser(
        val id: String,
        val name: String? = null,
        val email: String? = null,
        val user_code: String? = null,
        val avatar_url: String? = null
    )
Replace the showInviteStaffDialog function with this updated version:

Kotlin

    private fun showInviteStaffDialog(inviteCode: String?, expiryMillis: Long?) {
        val dialog = Dialog(this)
        val view = LayoutInflater.from(this).inflate(R.layout.dialog_invite_staff, null)
        dialog.setContentView(view)
        dialog.setCancelable(true)
        dialog.window?.setBackgroundDrawableResource(android.R.color.transparent)
        
        // Dynamic width adjustment
        val width = (resources.displayMetrics.widthPixels * 0.90).toInt()
        dialog.window?.setLayout(width, android.view.ViewGroup.LayoutParams.WRAP_CONTENT)

        // UI References
        val codeText = view.findViewById<TextView>(R.id.storeCodeText)
        val expiryText = view.findViewById<TextView>(R.id.inviteCodeExpiry)
        val copyBtn = view.findViewById<View>(R.id.btnCopyCode) // Changed to View to match FrameLayout
        val generateBtn = view.findViewById<TextView>(R.id.btnGenerateCode)
        
        // Search UI References
        val searchInput = view.findViewById<EditText>(R.id.searchInput)
        val searchLoader = view.findViewById<View>(R.id.searchLoader)
        val searchIcon = view.findViewById<ImageView>(R.id.searchIconStatic)
        val textNotFound = view.findViewById<TextView>(R.id.textNotFound)
        val userResultContainer = view.findViewById<LinearLayout>(R.id.userResultContainer)
        val foundAvatar = view.findViewById<ImageView>(R.id.foundUserAvatar)
        val foundName = view.findViewById<TextView>(R.id.foundUserName)
        val foundDetails = view.findViewById<TextView>(R.id.foundUserDetails)
        val btnInvite = view.findViewById<Button>(R.id.btnInvite)
        val inviteErrorText = view.findViewById<TextView>(R.id.inviteErrorText)

        // Logic State
        var selectedUser: SearchedUser? = null
        val searchHandler = Handler(Looper.getMainLooper())
        var searchRunnable: Runnable? = null

        // --- Store Code Logic (Keep Existing) ---
        fun updateCodeUI(code: String?, expiresAt: Long?) {
            codeText.text = code ?: "No Code"
            inviteCodeCountdownJob?.cancel()

            val now = System.currentTimeMillis()
            if (code != null && expiresAt != null) {
                if (expiresAt > now) {
                    startInviteCountdown(expiryText, codeText, copyBtn.findViewById(R.id.btnCopyCode), expiresAt) // Check ID if needed
                } else {
                    expiryText.text = "Code expired"
                }
            } else {
                expiryText.text = if (code == null) "" else "Code expired"
            }
        }
        updateCodeUI(inviteCode, expiryMillis)

        copyBtn.setOnClickListener {
            val code = codeText.text.toString()
            if (code.isNotEmpty() && code != "No Code") {
                val clipboard = getSystemService(CLIPBOARD_SERVICE) as ClipboardManager
                val clip = ClipData.newPlainText("Store Code", code)
                clipboard.setPrimaryClip(clip)
                Toast.makeText(this, "Code copied.", Toast.LENGTH_SHORT).show()
            }
        }

        generateBtn.setOnClickListener {
            if (userRole != "owner") {
                Toast.makeText(this, "Only owner can generate codes.", Toast.LENGTH_SHORT).show()
                return@setOnClickListener
            }
            val sId = currentStoreId ?: return@setOnClickListener
            // Show loading on the text itself
            generateBtn.text = "Regenerating..."
            generateBtn.isEnabled = false
            
            lifecycleScope.launch {
                try {
                    val params = buildJsonObject { put("p_store_id", sId) }
                    val rows = supabase.postgrest.rpc("regenerate_invite_code", params).decodeList<InviteCodeReturn>()
                    val row = rows.firstOrNull()
                    val newCode = row?.invite_code
                    val created = row?.invite_code_created_at

                    val newCreatedMillis = parseInviteCreatedMillis(created)
                    val newExpiry = newCreatedMillis?.plus(86400000L)

                    runOnUiThread {
                        updateCodeUI(newCode, newExpiry)
                        Toast.makeText(this@HomeActivity, "Code updated.", Toast.LENGTH_SHORT).show()
                    }
                } catch (e: Exception) {
                    Toast.makeText(this@HomeActivity, "Failed to generate code.", Toast.LENGTH_SHORT).show()
                } finally {
                    generateBtn.text = "Regenerate Code"
                    generateBtn.isEnabled = true
                }
            }
        }

        // --- New Search Logic ---
        
        fun toggleInviteButton() {
            btnInvite.isEnabled = selectedUser != null
            btnInvite.alpha = if (selectedUser != null) 1.0f else 0.5f
        }

        val performSearch = { query: String ->
            searchLoader.visibility = View.VISIBLE
            searchIcon.visibility = View.GONE
            textNotFound.visibility = View.GONE
            userResultContainer.visibility = View.GONE
            selectedUser = null
            toggleInviteButton()

            lifecycleScope.launch {
                try {
                    val results = supabase.postgrest.rpc("search_app_user", buildJsonObject {
                        put("search_term", query)
                    }).decodeList<SearchedUser>()

                    searchLoader.visibility = View.GONE
                    searchIcon.visibility = View.VISIBLE

                    if (results.isNotEmpty()) {
                        val user = results[0]
                        selectedUser = user
                        
                        // Update User Card
                        userResultContainer.visibility = View.VISIBLE
                        foundName.text = user.name ?: "Unnamed User"
                        val code = user.user_code ?: "NO-ID"
                        val email = user.email ?: ""
                        foundDetails.text = "$code • $email"
                        
                        // Load Avatar
                        if (!user.avatar_url.isNullOrBlank()) {
                            foundAvatar.load(user.avatar_url) {
                                crossfade(true)
                                transformations(CircleCropTransformation())
                            }
                        } else {
                            foundAvatar.setImageResource(R.drawable.icon_profile)
                        }
                        
                        // Highlight border (Optional: change background color logic if needed)
                    } else {
                        textNotFound.visibility = View.VISIBLE
                    }
                } catch (e: Exception) {
                    Log.e("InviteStaff", "Search failed", e)
                    searchLoader.visibility = View.GONE
                    searchIcon.visibility = View.VISIBLE
                    textNotFound.text = "Error searching user."
                    textNotFound.visibility = View.VISIBLE
                }
                toggleInviteButton()
            }
        }

        searchInput.addTextChangedListener(object : TextWatcher {
            override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) {}
            override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) {
                // Remove pending search
                searchRunnable?.let { searchHandler.removeCallbacks(it) }
                
                inviteErrorText.visibility = View.GONE
                val query = s.toString().trim()

                if (query.isEmpty()) {
                    searchLoader.visibility = View.GONE
                    searchIcon.visibility = View.VISIBLE
                    textNotFound.visibility = View.GONE
                    userResultContainer.visibility = View.GONE
                    selectedUser = null
                    toggleInviteButton()
                    return
                }

                // Debounce 500ms
                searchRunnable = Runnable { performSearch(query) }
                searchHandler.postDelayed(searchRunnable!!, 500)
            }
            override fun afterTextChanged(s: Editable?) {}
        })

        // --- Role Spinner ---
        val roleSpinner = view.findViewById<Spinner>(R.id.roleSpinner)
        // Map display names to internal values
        val rolesDisplay = listOf("View only price list", "Manage prices")
        val rolesValue = listOf("employee", "manager")
        
        val adp = android.widget.ArrayAdapter(this, android.R.layout.simple_spinner_dropdown_item, rolesDisplay)
        roleSpinner.adapter = adp

        // --- Button Actions ---
        view.findViewById<Button>(R.id.btnBack).setOnClickListener { dialog.dismiss() }

        btnInvite.setOnClickListener {
            val user = selectedUser ?: return@setOnClickListener
            val sId = currentStoreId ?: return@setOnClickListener
            val roleIdx = roleSpinner.selectedItemPosition
            val selectedRole = rolesValue.getOrElse(roleIdx) { "employee" }

            btnInvite.text = "Inviting..."
            btnInvite.isEnabled = false

            lifecycleScope.launch {
                try {
                    // Use the email from the found user object
                    val params = buildJsonObject {
                        put("p_store_id", sId)
                        put("p_email", user.email)
                        put("p_role", selectedRole)
                    }
                    supabase.postgrest.rpc("send_store_invitation", params)
                    
                    Toast.makeText(this@HomeActivity, "Invitation sent to ${user.name}", Toast.LENGTH_SHORT).show()
                    dialog.dismiss()
                } catch (e: Exception) {
                    val msg = e.message ?: "Failed to invite."
                    inviteErrorText.text = if(msg.contains("already a member")) "User is already a member." else "Failed to send invitation."
                    inviteErrorText.visibility = View.VISIBLE
                    btnInvite.text = "Invite"
                    btnInvite.isEnabled = true
                }
            }
        }

        dialog.setOnDismissListener { inviteCodeCountdownJob?.cancel() }
        dialog.show()
    }
This updates the HomeActivity.kt to fully replicate the website's flow:

Typing in the search bar waits 500ms (debounce).

Calls search_app_user RPC.

Displays result in a card with the user's avatar, name, and code.

Disables the invite button until a valid user is selected.

Calls send_store_invitation on click.